#cloud-config

update:
  group:  "alpha"
locksmith:
  reboot_strategy:  "etcd-lock"
  etcd_endpoints:   "https://10.100.130.113:2379,https://10.100.130.111:2379,https://10.100.130.112:2379,https://10.100.130.114:2379"
  etcd_cafile:      "/var/lib/etcd/ssl/ca.pem"
  etcd_certfile:    "/var/lib/etcd/ssl/etcd-nodes.pem"
  etcd_keyfile:     "/var/lib/etcd/ssl/etcd-nodes-key.pem"

passwd:
  users:
    - name: core
      ssh_authorized_keys:
        - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC8vuYTJs0b/fRAy97mXI9pOnL/gPknFpt4r/5tK8n7MnLXnfUY5zNIXbyrNxFhPuvB961no9yjeuis1c1UwKsdh8tmYhZn4eMWD7YXMwMlpU1Sk5+CJo7xBqQu62CcJbcvuXzUTco1ytnEqyhDZGmAQT3t4QaKKVkBFx17jpiz4subNR4xiIl+NGKWRmnrBru+AW4BhgsWfqZ3PuFnvSb7NNtpzBv8RnHDE58gXpFdbH+n7QhVyPY0ObBeeunOPTdxQ0rdK4RIsqQEujze6Fxex44d46rA8YsCmfW2XG+loVrvNv6OCPNt5l7fArgr9DYWZtkme5uCflTjrDZPlPcF mkoyan@devops"

    - name: mkoyan
      password_hash: "$6$rounds=4096$J5D/WMPiRMY$Y8SsVHtgfz0nBXY8SrYOqW3qZEVUYF2ZsN5dUYQS0zzx7B/fwHCRdBTqo2Zbn3w7o4vxNs57bMlDQk8JN3A1e/"
      ssh_authorized_keys:
        - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC8vuYTJs0b/fRAy97mXI9pOnL/gPknFpt4r/5tK8n7MnLXnfUY5zNIXbyrNxFhPuvB961no9yjeuis1c1UwKsdh8tmYhZn4eMWD7YXMwMlpU1Sk5+CJo7xBqQu62CcJbcvuXzUTco1ytnEqyhDZGmAQT3t4QaKKVkBFx17jpiz4subNR4xiIl+NGKWRmnrBru+AW4BhgsWfqZ3PuFnvSb7NNtpzBv8RnHDE58gXpFdbH+n7QhVyPY0ObBeeunOPTdxQ0rdK4RIsqQEujze6Fxex44d46rA8YsCmfW2XG+loVrvNv6OCPNt5l7fArgr9DYWZtkme5uCflTjrDZPlPcF mkoyan@devops"
      home_dir: /home/mkoyan
      groups:
        - sudo
        - docker
      shell: /bin/bash

networkd:
  units:
    - name: 00-ens192.network
      contents: |
        [Match]
        Name=ens192

        [Network]
        DNS=10.100.130.1
        Address=10.100.130.115/24
        Gateway=10.100.130.1
storage:
    - path:       /etc/environment
      filesystem: root
      mode:       0644
      contents:
        inline: |
          ADVERTISE_IP=10.100.130.115
          COREOS_HOSTNAME=api-server-1

          ETCDCTL_CACERT=/var/lib/etcd/ssl/ca.pem
          ETCDCTL_CERT=/var/lib/etcd/ssl/etcd-nodes.pem
          ETCDCTL_KEY=/var/lib/etcd/ssl/etcd-nodes-key.pem
          ETCDCTL_ENDPOINTS="https://10.100.130.113:2379,https://10.100.130.111:2379,https://10.100.130.112:2379,https://10.100.130.114:2379"
          ETCDCTL_API=3 
          ETCD_ENDPOINTS="https://10.100.130.113:2379,https://10.100.130.111:2379,https://10.100.130.112:2379,https://10.100.130.114:2379"

          FLANNELD_IFACE=10.100.130.115
          FLANNELD_ETCD_ENDPOINTS="https://10.100.130.113:2379,https://10.100.130.111:2379,https://10.100.130.112:2379,https://10.100.130.114:2379"
          FLANNELD_ETCD_PREFIX="/coreos.com/network"

          LOCKSMITHCTL_ETCD_CAFILE=/var/lib/etcd/ssl/ca.pem
          LOCKSMITHCTL_ETCD_CERTFILE=/var/lib/etcd/ssl/etcd-nodes.pem
          LOCKSMITHCTL_ETCD_KEYFILE=/var/lib/etcd/ssl/etcd-nodes-key.pem
          LOCKSMITHCTL_ENDPOINT="https://10.100.130.113:2379,https://10.100.130.111:2379,https://10.100.130.112:2379,https://10.100.130.114:2379"
    - path:       /etc/hostname
      filesystem: root
      mode:       0644
      contents:
        inline: | 
          api-server-1.mkoyan.local       
    - path:       /etc/hosts
      filesystem: root
      mode:       0644
      contents:
        inline: |
          127.0.0.1	localhost
          ::1		localhost
          10.100.130.115     api-server-1    api-server-1.mkoyan.local
           
          10.100.130.111     coreos-1    coreos-1.mkoyan.local
           
          10.100.130.112     coreos-2    coreos-2.mkoyan.local
           
          10.100.130.114     coreos-4    coreos-4.mkoyan.local
          
          
    - path:       /etc/motd
      filesystem: root
      mode: 0644
      contents:
        inline: | 
          Hey Mkoyan!
    - path:       /etc/systemd/timesyncd.conf
      filesystem: root
      mode: 0644
      contents:
        inline: |
          [Time]
          NTP=10.100.130.1

    - path: /var/lib/etcd/ssl/ca.pem
      filesystem: root
      mode: 0644
      contents:
        inline: |
          -----BEGIN CERTIFICATE-----
          MIIDxDCCAqygAwIBAgIUbTpbTo9spKItWzAP2usN2ddzJZ8wDQYJKoZIhvcNAQEL
          BQAwaDELMAkGA1UEBhMCQU0xEDAOBgNVBAgTB1llcmV2YW4xEDAOBgNVBAcTB1ll
          cmV2YW4xEzARBgNVBAoTCkt1YmVybmV0ZXMxCzAJBgNVBAsTAkNBMRMwEQYDVQQD
          EwpLdWJlcm5ldGVzMB4XDTE5MDMyMDEzMzgwMFoXDTI0MDMxODEzMzgwMFowaDEL
          MAkGA1UEBhMCQU0xEDAOBgNVBAgTB1llcmV2YW4xEDAOBgNVBAcTB1llcmV2YW4x
          EzARBgNVBAoTCkt1YmVybmV0ZXMxCzAJBgNVBAsTAkNBMRMwEQYDVQQDEwpLdWJl
          cm5ldGVzMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA8SrmL6BYGkH0
          SB7l7iGSFuIKJlEuW07Lg0nK0HOk3dDTKkPXQRvJ7G3LHzzN1by/z9JOjoAS+cL2
          e+ZM+ttoRZ+hwve1n3Qv6WR2iKlNeoAP4Gzz+sYyvTvf3iosfSo0f7oFesvjUkHx
          C1m3R4SRMRd9rQe0yytk9FjRF7LaTe1exhtpQmFXc1vOYhRny/Xf0zxgS1MW96Gr
          7gWRGgoA0qlA10J9jxDcb5DELfbrINddfvGhL8Y3hGVwOjh67eqsx/02NpWgTLfN
          NUmVeP9Pv9vLFkEx0NBQNoOtYT5PxeVN7Ng6fwURrokvf7h3+PxNo7/FkAhCzChV
          pGmZvU7DywIDAQABo2YwZDAOBgNVHQ8BAf8EBAMCAQYwEgYDVR0TAQH/BAgwBgEB
          /wIBAjAdBgNVHQ4EFgQUIWX4/jzE0FeYrHZwkn7bNKIhk4gwHwYDVR0jBBgwFoAU
          IWX4/jzE0FeYrHZwkn7bNKIhk4gwDQYJKoZIhvcNAQELBQADggEBAIBp0uxM7ID2
          /v8RyXFF4fJGeLva4rhtd/obuoYMHt/hw3vd+jU0j7eTtsn1EudJIdOA+M4iIsQG
          PTQ98G10YQ/PTOLS346ifHF+CuMHP7+hX/g7SCNTivqTC3mOc2WpinSsq4y0R2PI
          Cs5UK5j0XYNfIL6WW5hzLCbFTFuorN4Kvwgk7tKqa0hFSrCtwJQr3gSEsdGmKaOJ
          qA2UBYB1B9w+505DGl251bcR9LH9T2ZXffheFYfXd8M+y/eRIKkh6wbL2BcFQSaD
          EkzMkYdgi1u6aR+YdBj+pNeUl3b37ZU9cP82ENSIhPHOB2EKwCBIyB2Vz7JsMtMx
          olhW8FEusbI=
          -----END CERTIFICATE-----

    - path: /var/lib/etcd/ssl/etcd-nodes.pem
      filesystem: root
      mode: 0644
      contents:
        inline: |
          -----BEGIN CERTIFICATE-----
          MIIEADCCAuigAwIBAgIUOZzoPtt9+fhWm0cdtgFTyVCgZiQwDQYJKoZIhvcNAQEL
          BQAwaDELMAkGA1UEBhMCQU0xEDAOBgNVBAgTB1llcmV2YW4xEDAOBgNVBAcTB1ll
          cmV2YW4xEzARBgNVBAoTCkt1YmVybmV0ZXMxCzAJBgNVBAsTAkNBMRMwEQYDVQQD
          EwpLdWJlcm5ldGVzMB4XDTE5MDMyMDEzMzgwMFoXDTIwMDMxOTEzMzgwMFowZjEL
          MAkGA1UEBhMCQU0xEDAOBgNVBAgTB1llcmV2YW4xEDAOBgNVBAcTB1llcmV2YW4x
          EzARBgNVBAoTCmt1YmVybmV0ZXMxDzANBgNVBAsTBm1rb3lhbjENMAsGA1UEAxME
          RVRDRDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALLXao+pRvQmNJBX
          NMWjdseeaZpRZj/f1fzRgTpfX6xQ/mDBlfS88N6IOf3g4oDgEXFMyD+AKIWCvm5g
          2MN1QlBFfZljfQyCTxhwfHrlzTijzwotRIySZlHyonSVNVLk+OZLOr2NjmzSrwOj
          MFArg2Qne7uQxl8n7IgOr/Tx6hMZWP+H4g507pItH06u1o+oyfZ3zwpg+kCmWlmp
          gQ24pCKArGLZqg3gKxYH797/G5HKGIjL6SLVZXJNOa1fbqLKUiZtFost1D58IQVw
          nUAyOKfzkda714h/NDey5u6fvLLgGdsIerwjg7t7xv7ip+DkSf/LgRWoG8Bsx5tG
          IDow1wUCAwEAAaOBozCBoDAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYB
          BQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFAjtYE91ofd/
          X5g4vgNrFYlGr6GVMB8GA1UdIwQYMBaAFCFl+P48xNBXmKx2cJJ+2zSiIZOIMCEG
          A1UdEQQaMBiHBApkgm+HBApkgnCHBApkgnGHBH8AAAEwDQYJKoZIhvcNAQELBQAD
          ggEBABkdPtqdwB1FzIrBP/bMpBKBVqHQNgwP2/gq8blXbDbqW3UTiGTxmSOj7Btz
          lWyG9t6TY9UcYbyOutSDMl9Ajk6UCJXv0qMC/WKUsYCdMMt6gYqo7QCQZFgbyhQP
          wAQY9F864KZtyFrX783Su7tsl0kesNrMgX4x8bcoLAtBFjgzg/5SN6oBN2NRTqDe
          3DZ36yk8lnQ/QovucPH0gvAhHksNPVaE5Kn1zV/r0ekHkLMWfJShXBTMw7PVjsJY
          mB00PXNXPo1+GITq1r0pRAODfr+IyWfiCRQOsskhMkgaTr8k7uFOabU1e+A7/Cp6
          c8w74nrdjOOsxiXab99lQT8w/uE=
          -----END CERTIFICATE-----

    - path: /var/lib/etcd/ssl/etcd-nodes-key.pem
      filesystem: root
      mode: 0600
      contents:
        inline: |
          -----BEGIN RSA PRIVATE KEY-----
          MIIEowIBAAKCAQEAstdqj6lG9CY0kFc0xaN2x55pmlFmP9/V/NGBOl9frFD+YMGV
          9Lzw3og5/eDigOARcUzIP4AohYK+bmDYw3VCUEV9mWN9DIJPGHB8euXNOKPPCi1E
          jJJmUfKidJU1UuT45ks6vY2ObNKvA6MwUCuDZCd7u5DGXyfsiA6v9PHqExlY/4fi
          DnTuki0fTq7Wj6jJ9nfPCmD6QKZaWamBDbikIoCsYtmqDeArFgfv3v8bkcoYiMvp
          ItVlck05rV9uospSJm0Wiy3UPnwhBXCdQDI4p/OR1rvXiH80N7Lm7p+8suAZ2wh6
          vCODu3vG/uKn4ORJ/8uBFagbwGzHm0YgOjDXBQIDAQABAoIBADS+Uy8LPWHD4ryu
          +2FOVDmK/poEZ6Nu4C0vnG0as5yeRmdCsHb9QgxfILs/F43qhzpi6qvPoCO/62mi
          Jkt+yY/i7qfOL5MA21LZ2dxk6aFKrkTSFOVgR8zjQgYf+xn3bXB9v1Un6lktyW/J
          MPZz3swq2NL4X4iwvZFiw4H51o7K7JtPIp6Rvb4909JmiULIcgAC6Nlc7489m0+c
          J9tmTsxPPQO/f1xyiQbppfLQdQFvECB/r0n7nM1zAD/1HoBlsy1BXxWQRRpmHuVt
          WER5VPPQplm1dhvJzHXPqrnopNS7rBVc1RZcRzU9hohzSMtWEgkUpngd/Gi6hFg4
          5O0SsAECgYEA4D+5V6EggiGX1Z7li2q+HDmmdejepiioGcmvyLpv+5LW7tTpyaEe
          azq4OwNUeGkPp31assZG9mD4FEHrU8MRuIfwwo/Lnw5NQB1cdoEHqI0OpDkrE3Ln
          FbOOg2Qh1oOJP+A9IN4lwqQUsS6/y4yjLfxX4YeguJid8P6j1JjKPa0CgYEAzCnS
          znvlAJKMkl9Uy3HSPpRGooE4dkN5cz+PBmyG0/hgt16DVQjqyh2bZ1eOIuwQrC0j
          3ToUs5wkpZesfwoMr2hiu/Fukd47rr2IUHiTVrZepdlh7xZxcL8beyY1cGRQDyhz
          ej+rIzDFO+Er9O4fqSnuwUsAwgHITrwI5xnh+bkCgYBhb87coIo7gNU0YMJkfZD1
          Oqd1fCWiFPBVpCjZEwktSnRRefnLPlK1TOJX4e6GE0BWCkWqgDS9QQ0J4EqcLpo4
          j/iw0UIsbk5qmVdftljZh9Dg0mZBIR//cfFubce2KZktRAXLjjriA+Fpy2JS01zj
          0k1tFT1keAvIdxxAd9MIUQKBgF48Z8tbMIalHjFpw0/sh6jO9BOKJa+g0Ww6yB+k
          9E7e9HVvMJuNdCI6rEJ1DWxdHgz7APTaHDgTOG8epUY2M0i7m+c4N1spAs9TOJo8
          LXX205Ul06hx6YarD1o2drAb/UAh4btpq+qgVkmfU5TIXODONCAQKJdkDzsYW9uf
          /MgxAoGBAKPpOGjg+EWmlCj1AwO4sqj7QOJY8MvVwgeyCfg4Lv80DwNYRNaiPIml
          FkH9fvTnHbcrlQNSnRaPB9PCgUfSj2uS7muZJ+GKeQmB6A8ylA+PMmxpX+EZz04N
          WOt/eCJAwMZCyFaBaCci5xiM9ezVLUZvhw4KC8mSSaMOpi6PTFx4
          -----END RSA PRIVATE KEY-----


    - path: /etc/kubernetes/ssl/ca.pem
      filesystem: root
      mode: 0644
      contents:
        inline: |
          -----BEGIN CERTIFICATE-----
          MIIDxDCCAqygAwIBAgIUbTpbTo9spKItWzAP2usN2ddzJZ8wDQYJKoZIhvcNAQEL
          BQAwaDELMAkGA1UEBhMCQU0xEDAOBgNVBAgTB1llcmV2YW4xEDAOBgNVBAcTB1ll
          cmV2YW4xEzARBgNVBAoTCkt1YmVybmV0ZXMxCzAJBgNVBAsTAkNBMRMwEQYDVQQD
          EwpLdWJlcm5ldGVzMB4XDTE5MDMyMDEzMzgwMFoXDTI0MDMxODEzMzgwMFowaDEL
          MAkGA1UEBhMCQU0xEDAOBgNVBAgTB1llcmV2YW4xEDAOBgNVBAcTB1llcmV2YW4x
          EzARBgNVBAoTCkt1YmVybmV0ZXMxCzAJBgNVBAsTAkNBMRMwEQYDVQQDEwpLdWJl
          cm5ldGVzMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA8SrmL6BYGkH0
          SB7l7iGSFuIKJlEuW07Lg0nK0HOk3dDTKkPXQRvJ7G3LHzzN1by/z9JOjoAS+cL2
          e+ZM+ttoRZ+hwve1n3Qv6WR2iKlNeoAP4Gzz+sYyvTvf3iosfSo0f7oFesvjUkHx
          C1m3R4SRMRd9rQe0yytk9FjRF7LaTe1exhtpQmFXc1vOYhRny/Xf0zxgS1MW96Gr
          7gWRGgoA0qlA10J9jxDcb5DELfbrINddfvGhL8Y3hGVwOjh67eqsx/02NpWgTLfN
          NUmVeP9Pv9vLFkEx0NBQNoOtYT5PxeVN7Ng6fwURrokvf7h3+PxNo7/FkAhCzChV
          pGmZvU7DywIDAQABo2YwZDAOBgNVHQ8BAf8EBAMCAQYwEgYDVR0TAQH/BAgwBgEB
          /wIBAjAdBgNVHQ4EFgQUIWX4/jzE0FeYrHZwkn7bNKIhk4gwHwYDVR0jBBgwFoAU
          IWX4/jzE0FeYrHZwkn7bNKIhk4gwDQYJKoZIhvcNAQELBQADggEBAIBp0uxM7ID2
          /v8RyXFF4fJGeLva4rhtd/obuoYMHt/hw3vd+jU0j7eTtsn1EudJIdOA+M4iIsQG
          PTQ98G10YQ/PTOLS346ifHF+CuMHP7+hX/g7SCNTivqTC3mOc2WpinSsq4y0R2PI
          Cs5UK5j0XYNfIL6WW5hzLCbFTFuorN4Kvwgk7tKqa0hFSrCtwJQr3gSEsdGmKaOJ
          qA2UBYB1B9w+505DGl251bcR9LH9T2ZXffheFYfXd8M+y/eRIKkh6wbL2BcFQSaD
          EkzMkYdgi1u6aR+YdBj+pNeUl3b37ZU9cP82ENSIhPHOB2EKwCBIyB2Vz7JsMtMx
          olhW8FEusbI=
          -----END CERTIFICATE-----

    - path: /etc/kubernetes/ssl/ca-key.pem
      filesystem: root
      mode: 0600
      contents:
        inline: |
          -----BEGIN RSA PRIVATE KEY-----
          MIIEpAIBAAKCAQEA8SrmL6BYGkH0SB7l7iGSFuIKJlEuW07Lg0nK0HOk3dDTKkPX
          QRvJ7G3LHzzN1by/z9JOjoAS+cL2e+ZM+ttoRZ+hwve1n3Qv6WR2iKlNeoAP4Gzz
          +sYyvTvf3iosfSo0f7oFesvjUkHxC1m3R4SRMRd9rQe0yytk9FjRF7LaTe1exhtp
          QmFXc1vOYhRny/Xf0zxgS1MW96Gr7gWRGgoA0qlA10J9jxDcb5DELfbrINddfvGh
          L8Y3hGVwOjh67eqsx/02NpWgTLfNNUmVeP9Pv9vLFkEx0NBQNoOtYT5PxeVN7Ng6
          fwURrokvf7h3+PxNo7/FkAhCzChVpGmZvU7DywIDAQABAoIBAQCk67JIJX26TxoP
          a9nPM/PkZCWOuHtcA5FWsdLZJAw9iD2vrH76TleSsC50qS8VmCMPqoEAIANZ+4J1
          jjNcZUh0PErxulXguiK9l28b27NZL1QsJDXga0NtdxGLqwmLep42Lm7q350Ptnpx
          SaP1a2miya6u8hMn0QATvN0YOL3jBTmu88fT1Ez1qgK2UBcoEOBEHt6dZvwB1E5D
          UdWcy8nYNPJxUMklRvYL3QOfzVhYujt+Zhia1UTf7B7vuz7Wm7USIr+7N6KPtHB2
          0BhK5vPoFaRE7NBo8MxcsSdQcAuolu30zRydXpY7PcM386DePtjouFoTleuVaZv7
          dFVHL405AoGBAPbRbY0o843ZopDhs5sXoxI3FB6jWHyzOsIBnDuwNAo0mHFvBSn/
          7+J20ZzD6ObtfJp+y4Hd+gp2qQp5Sd/tOBkeolY1OdraaNhkUS4dDw0o3mN3A4Ly
          T3m4j+TjTIW+cqiQBGnT895CmT1sHrjKk4zBcLI/2ncXCDwtmxMAI/hPAoGBAPoj
          qJ4HKShY+4zRbyg+815w1fUxNBNajroJBGahwVDrm940rkCZp9fqweMk4wsVUpeV
          upGgCA1VSqoPW7/XTHl6ZBbkq42+5vdbU3iwkV8av4dyXECe91hvJjQ5kAr45U1b
          h8Xkdh5/xoe2fPtKZnNZppMoDpbnHeL5z/ehWaHFAoGBAIUY6Je/pp8u5oB0hdMz
          yudOtlXTRitwx1XJYoO5gEakmDRLZyB/+M9Jvb1o1BZ7qL7zczDkECtGU9/nChRs
          Kt047NfKOhmvv+w5JKHWX8B78nj2u/kITB1ajpYikKhqzA/kIc0j1BVeGp7JyENk
          Um8L/YbR8jBYRkOVYFO9tqf3AoGAbqL1AqiSKLlq0bcUnk1xoVTxHZkcum60cE5q
          tuZWte7wKxFL/WC5H0RDa682CQHuXQOp2J1a0mLmOl++qhSVS6m5uXJ8+p30VHX9
          boVSVylii4smiKKHLoNC95h6QJAkA9o3LG1HXWgQrJgnoZIfzGdbyPzPrykcS/dI
          Z/PizC0CgYBwT6rV4bs1qdF9UilB6Ngp0CXEdQlPlKgw56il+MGDvwJP7W6ngls9
          /qAwe+FdIFD9M4Cgq04oU8jD8WkpL5qM+raBN3Pzw9+SsJHyJpIEZ7Mr/uD2cskf
          oR1hC0Gl4CnSUPwbVGKWHGQc2pR1mPFxl+TjoECHB3K/vebkBfAKqg==
          -----END RSA PRIVATE KEY-----
          
    - path: /etc/kubernetes/ssl/apiserver.pem
      filesystem: root
      mode: 0644
      contents:
        inline: |
          -----BEGIN CERTIFICATE-----
          MIIEjDCCA3SgAwIBAgIUci2nd7sLb2ddmYGNEFY2BJFWnHgwDQYJKoZIhvcNAQEL
          BQAwaDELMAkGA1UEBhMCQU0xEDAOBgNVBAgTB1llcmV2YW4xEDAOBgNVBAcTB1ll
          cmV2YW4xEzARBgNVBAoTCkt1YmVybmV0ZXMxCzAJBgNVBAsTAkNBMRMwEQYDVQQD
          EwpLdWJlcm5ldGVzMB4XDTE5MDMyMDEzMzgwMFoXDTIwMDMxOTEzMzgwMFowazEL
          MAkGA1UEBhMCQU0xDzANBgNVBAgTBlllcnZhbjEQMA4GA1UEBxMHWWVyZXZhbjET
          MBEGA1UEChMKS3ViZXJuZXRlczEPMA0GA1UECxMGbWtveWFuMRMwEQYDVQQDEwpr
          dWJlcm5ldGVzMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEApm43AptB
          B6twb8Ex7xo1jkr9h1H17qsBqgr0e0/MvvuM5SB4Kg/srB/gyEe6O7SuP6ldXDVk
          mJKQnACgV9g/vk3LCvIREgxmgetmyAcY97M+QsBf+w7vIx5WAFwl37DokbNMeU57
          PyBrJS2IWyizY7rD7IKYVEJJIEWoVv7Dv/COlSvopTA9WxFjl1w7nvlRES1Havcf
          1VqzFoFsTle7c+UyCg2jHj+Gaj6l7aVxMwm1rD6idiY0oEWwIIPNMkm28uweET8l
          V4FUKjHdoRkYnUhHtA1MmKy1htPcbSLHPeyrstfQcs7fWnVIbNl0460OHAn/q3Y9
          Nu2u4CskQAWRvQIDAQABo4IBKTCCASUwDgYDVR0PAQH/BAQDAgWgMB0GA1UdJQQW
          MBQGCCsGAQUFBwMBBggrBgEFBQcDAjAMBgNVHRMBAf8EAjAAMB0GA1UdDgQWBBQh
          /HYML/InfAkzBPNdqX9Lf11vBDAfBgNVHSMEGDAWgBQhZfj+PMTQV5isdnCSfts0
          oiGTiDCBpQYDVR0RBIGdMIGaggprdWJlcm5ldGVzghJrdWJlcm5ldGVzLmRlZmF1
          bHSCFmt1YmVybmV0ZXMuZGVmYXVsdC5zdmOCHWt1YmVybmV0ZXMuZGVmYXVsdC5z
          dmMubWtveWFugiNrdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLm1rb3lhbi5sb2NhbIcE
          CgMAAYcECmSCc4cECmSCdIcECmSCdYcEfwAAATANBgkqhkiG9w0BAQsFAAOCAQEA
          r2RuDEYEoSTVcgzLQ9RZPysR7trOnTxcR3jWBiEIYIXk8BhnCpYqCqdE2ipQOOxJ
          ApuLiFFpOV0BMOahSbgEW6uOJEJw2o715GL8mo923VbOEUOkRshhs7FgYlYXgHMG
          S3Z7ZrWZCLqguK3Al/PKnUz34cOImaps0KW4gj7c94hfcJv6mymeSNklspWjD2W4
          JOZMhFQmd03ssiUaAT5KPP7U2ulKAsfpeC6zr2Y0sCVUr4EW4Myw+AffIZkH4ILl
          zNpr9DSYYK4nCO/BMtcgvvIoGWXybgq4VrnO5Jo8wd65YUlKcrQognbEnMxR1kb5
          yNxCGshnq4+959QegIoFVg==
          -----END CERTIFICATE-----

    - path: /etc/kubernetes/ssl/apiserver-key.pem
      filesystem: root
      mode: 0600
      contents:
        inline: |
          -----BEGIN RSA PRIVATE KEY-----
          MIIEogIBAAKCAQEApm43AptBB6twb8Ex7xo1jkr9h1H17qsBqgr0e0/MvvuM5SB4
          Kg/srB/gyEe6O7SuP6ldXDVkmJKQnACgV9g/vk3LCvIREgxmgetmyAcY97M+QsBf
          +w7vIx5WAFwl37DokbNMeU57PyBrJS2IWyizY7rD7IKYVEJJIEWoVv7Dv/COlSvo
          pTA9WxFjl1w7nvlRES1Havcf1VqzFoFsTle7c+UyCg2jHj+Gaj6l7aVxMwm1rD6i
          diY0oEWwIIPNMkm28uweET8lV4FUKjHdoRkYnUhHtA1MmKy1htPcbSLHPeyrstfQ
          cs7fWnVIbNl0460OHAn/q3Y9Nu2u4CskQAWRvQIDAQABAoIBAC1vwYzwndxeLaAU
          +nDwktZ6GqUq9x1lilrGCuDvdFJfkqOrLaMuHcsQGOoUyv8p4Lh4oIhf+0q8GMa+
          VQgmfaCS1G/0jjyDLikh/zl01pgpU0IeCxYbiaXozkni3mQnhBbjAGnNx1AApb/M
          ooFgpzj+8CZNsRCv2A77dW3qt75amZ1wESy+nNzF05jBHFAZghHXniMEtTyHYxuU
          lb+5jEZR+3Sr2FY3xD3bTZUmMOm54wY8x0C/oqgvQ5gA8A+iGjqDo64dWpcW/a8R
          Jq+mHSP3noVQHIah6P9Egm7h0u9YZ6iNOVkeUX4srM0BUuI+E8Tlbzs6xyAxtxtr
          8M2NbHECgYEAz6n8R9L6dh9Bxo9B5t072KLRUXJ669VMtWi2adTsMzeT2xCosead
          CEWMzC5eFBl0+ykt1e6yquw4dmvWM5bQy261Zuf1zUWJtJjcYvDNtkgqosq4KK1s
          V72hgLP7oUFHD65Y1HZGWO9CAj2UJ5jRndH15Dtb/2S06CndUW6Z7yMCgYEAzStD
          G2asdHwLW86hq4+UHiC6ZParlnqxy4A9kdY0IZ65l2/gCNMiJI01F5va76xI0+vc
          WlQv5dmRjLP71ewGQdBc+PQLsdx9XTS/rWKPw/DkJbpdTFfJRXICqNLnXZmWV7nL
          l1atzZvRFAZvBp3jMYUuqT//puoTWzawi8V7+Z8CgYBclomo7GRHbkBBa3YSnOkl
          +dIh4kz0ATImX/2Uyh5V553Auni8ePniyj+weavwgjkqEn4hOD/o/VFfW00xyzhk
          u4Od0iZB05NGNjFs27icYSjBVGkvmcMIi8AKRjUW/KfWUgHBGMrctDBWF2aLERPE
          rexYSi8Ge7w9Fw1aVVnEyQKBgH6jaXSMV34+4rP0Qw4mPYKrKOIQ77CeYwf9TAOs
          d9kYo+25fEt2Jujw0AiWhvjRGtLUDtsig74YISL8JUHRwbr15a001dMfCbJyUK2w
          3JRRKEGxWs04kl9vE/0o0O6RUp8ra2MqeXUj7FWz8uveoNF8J2UIv8BDU1dF1osv
          hmp5AoGAQ5RWrlFb5ilJ9LFbuqqR7Zmar/sxaUOMcnXXb+Kj4fw8Q4sX84ifnO7w
          O7zTGYkv6z0rqo9Z1geCm971cQEDkt+tfL4+ZfAO/ulDgoMitSpIauOsdSXLbpOU
          bQa1bIzIuHGAFYOZfGHMWldGaEnPJuY/8raN2jSau/tTC+4woEM=
          -----END RSA PRIVATE KEY-----



    - path: /etc/kubernetes/ssl/service-account.pem
      filesystem: root
      mode: 0644
      contents:
        inline: |
          -----BEGIN CERTIFICATE-----
          MIID5jCCAs6gAwIBAgIUVd5qYZvXeV3fGQmZbJqp2uj7CLswDQYJKoZIhvcNAQEL
          BQAwaDELMAkGA1UEBhMCQU0xEDAOBgNVBAgTB1llcmV2YW4xEDAOBgNVBAcTB1ll
          cmV2YW4xEzARBgNVBAoTCkt1YmVybmV0ZXMxCzAJBgNVBAsTAkNBMRMwEQYDVQQD
          EwpLdWJlcm5ldGVzMB4XDTE5MDMyMDEzMzgwMFoXDTIwMDMxOTEzMzgwMFowcTEL
          MAkGA1UEBhMCQU0xDzANBgNVBAgTBlllcnZhbjEQMA4GA1UEBxMHWWVyZXZhbjET
          MBEGA1UEChMKS3ViZXJuZXRlczEPMA0GA1UECxMGbWtveWFuMRkwFwYDVQQDExBz
          ZXJ2aWNlLWFjY291bnRzMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA
          zUgtz/5auFY2x9QIbXGY4efEb1FjJpKHJA1Qhi93XiDsshMofnIcS6Iwg4J2sqBc
          EvChJlCDBpc9G+1EMnXCEMhcuLObz1RrrTfZeiwHN04zhgjw1jueJVyWfHUVHdDQ
          NPXZy/n/Xvyr9e7WAEJVE3OXFVdcAw/H0QXfIVTESAHoyJ30yQx7wqcap9xXjPT7
          A1s8+v3Uc5SIvtPwJ7p+TZZCWAXNisy65Zg5xDQ7FYpQ2LNH2M2qBNKBHo6+XX5A
          8lz/tHnIolidsnYRuSYhFvqZvqPxGkleyBVs+q7NvAMna+md/EzgnczBJ5X+3je3
          fNnG31JXM3ZghzVWgUROGQIDAQABo38wfTAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0l
          BBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYE
          FLd5Y5hBAbMnU1zw7k4W86YyhK4QMB8GA1UdIwQYMBaAFCFl+P48xNBXmKx2cJJ+
          2zSiIZOIMA0GCSqGSIb3DQEBCwUAA4IBAQDGXYKr33eRHpBnVEsuQs04iYXMwiDK
          hsYx6r+4qiDILKdZzii1RM3igkMF2ijdcQ/Hc7oC8+40fvwsKJld1cl6btks1zmH
          VvVAi/CnqJwwGpcSFfF01GQxqNpxHgzn/kA1XTLkfyrSPgBAqXoEsNbI1rZP++7A
          90a5kKJg5xUh51hUxIWT22A6v2Zikd1e0DniCo5TvXDyE9mMZiFjE7RD0JKQ5Ql/
          QBALhwOFHnDLPByix2AKArbg69BZFo/lRj0AWcxUE7L+zarcI9gJJxZNnIdDSqpo
          p2KKGkLRA9nRuSwHnVS1NgEJYEpEPIOl9p+CSE4/qJD9e/FrRMPNiF/b
          -----END CERTIFICATE-----


    - path: /etc/kubernetes/ssl/service-account-key.pem
      filesystem: root
      mode: 0600
      contents:
        inline: |
          -----BEGIN RSA PRIVATE KEY-----
          MIIEogIBAAKCAQEAzUgtz/5auFY2x9QIbXGY4efEb1FjJpKHJA1Qhi93XiDsshMo
          fnIcS6Iwg4J2sqBcEvChJlCDBpc9G+1EMnXCEMhcuLObz1RrrTfZeiwHN04zhgjw
          1jueJVyWfHUVHdDQNPXZy/n/Xvyr9e7WAEJVE3OXFVdcAw/H0QXfIVTESAHoyJ30
          yQx7wqcap9xXjPT7A1s8+v3Uc5SIvtPwJ7p+TZZCWAXNisy65Zg5xDQ7FYpQ2LNH
          2M2qBNKBHo6+XX5A8lz/tHnIolidsnYRuSYhFvqZvqPxGkleyBVs+q7NvAMna+md
          /EzgnczBJ5X+3je3fNnG31JXM3ZghzVWgUROGQIDAQABAoIBACSmr29EVYQ1+F/j
          LoID1yz2SW8qk85OOQypx+e9T82hiUEeBIvW6dBjK9A/Gdw4n1fOWKdTlqE1nXZ/
          /T4ZIkYGz+82OiphQzxRDWYvuDYaoz5aGE3XpRu8lS2xZczF/HaIMpOllf+qkzU8
          qD6xmSj46U+pIkd1qNJb/wOfc8/7HWxsnWLe4JsdcDYdPGpfNc3wmtq8y2mpMH7T
          qpHcM5E4RW474X8YGyG0QmXc2lWkTBTD3f5vENcoPFWpQnSrOGqqM7EcymEjz0jv
          OGMF2gePQ4aF5DbGF0wokLQbEtHb9+DigUR+3366L08v5eosaVDa+d/u46J3wklX
          qH7H0RECgYEA4rEt5W0b9nk4biTQOS/q5xfFw946ILMUwYsViEyzHSMEBt1LjwbX
          MEqw88U2563Qe89JksNWKH7ZtItLvG/Z21EVL5JnY2fFVdPsbhuYrzlZ1smkYcVb
          HKU0EcYmEXjmOFPz8DTdqdgqb/BP2/9KOmf/4Ett1DyNv+mZEsjJbg0CgYEA59Jj
          cLUtEeDJX/gLKo7uM2ZsK8lORvC6XYHCRP3dRqmJGEQResTyaGnHFoRgilTJhm0S
          C6wZSo9KWe8unT7AtLOJFy//dbRvLAYKA9TmW5Wel/4L/hwbCsGiLJx7zo3VKAvl
          cRD3A4qXT8OIRcmLl/bZcnh764koXWGC7sz5KT0CgYA+GIqZ7ela+pmakjr3b0jJ
          RJnHrXf+vQ9SdObRDzGBKbZQqw2ngBgyAkO2gq8nh1U0lPNyYE+ZiCXabs2wMHNc
          wDktbs0jTamgeQyqnKSWWv9g9pswrP7oOdiphb2ny5ZEl7qaceDGRZBaWVmGycdr
          eFF+/yp2mJ+7kiF8I8QJgQKBgB5vRJbbcltSg52R1wVzVlpxK+pjt18g45a7HmIo
          YhCQ2WrSJOlVSe3jVTvjjTkcAIkhcKkPoxJi1YQRHrGON4aBu5HLv2IYmi/Rayct
          oECN2BBkTfbCgdpbqYrp0GdBv6ZOSYUakRNp8ouKRC3FVApTYiDhKIO3shDwaFwp
          lNyRAoGAVSSk1huAEG349nnAksHzfUd85XYh556SC3um7YHHyM/xMX4uWtCvl+fy
          bDDxwoungP0Ym1RMVGSjNzlhSFmagVUW4amapNp76W2/p9kXy5cofwgS1fCmdlfR
          klFHaq4qMYT62M5CUgWalSWMihsURjny34B0bQGMGXQPLfZ/gYE=
          -----END RSA PRIVATE KEY-----


    - path: /etc/kubernetes/ssl/kube-controller-manager.pem
      filesystem: root
      mode: 0644
      contents:
        inline: |
          -----BEGIN CERTIFICATE-----
          MIIECjCCAvKgAwIBAgIUZ3fuGt8Lli3qvKS1kovuNlN7CGwwDQYJKoZIhvcNAQEL
          BQAwaDELMAkGA1UEBhMCQU0xEDAOBgNVBAgTB1llcmV2YW4xEDAOBgNVBAcTB1ll
          cmV2YW4xEzARBgNVBAoTCkt1YmVybmV0ZXMxCzAJBgNVBAsTAkNBMRMwEQYDVQQD
          EwpLdWJlcm5ldGVzMB4XDTE5MDMyMDEzMzgwMFoXDTIwMDMxOTEzMzgwMFowgZQx
          CzAJBgNVBAYTAkFNMRAwDgYDVQQIEwdZZXJldmFuMRAwDgYDVQQHEwdZZXJldmFu
          MScwJQYDVQQKEx5zeXN0ZW06a3ViZS1jb250cm9sbGVyLW1hbmFnZXIxDzANBgNV
          BAsTBm1rb3lhbjEnMCUGA1UEAxMec3lzdGVtOmt1YmUtY29udHJvbGxlci1tYW5h
          Z2VyMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxSw6Gri/MHdAIpxX
          C7XvNEP9YYGJNnJm4j4zLOfKoeUs/BPDkyKwwBh1Iy30Fed1iphd3cOoOhQNRffY
          46eDGggAx4SSZAPDyfqGx/Fkcjjzj/9Sza9dcMo97lG5N7IePHxILPEpJWuzs43z
          fBkXS2zvP4/25ebEuxD1/QhphNzW3WFc/et7y5OwNH4PHQnTHaS3jZZiZYJ4OXGw
          Q4NoJR8K0S3i82SXLeOL8lGgLCPtVji+Q67ZB0wP2z0E6/0K3f/ocoSgAWgaQog2
          GzgdObJFDzGk7A5pGZbTYLYinTyrFrHPnBLVc9e+Q487aqs8cCubIY5BTSUx3JkF
          1fzPWQIDAQABo38wfTAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUH
          AwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFC21eSW4pZvt2WaA
          PlVxFaMek7nfMB8GA1UdIwQYMBaAFCFl+P48xNBXmKx2cJJ+2zSiIZOIMA0GCSqG
          SIb3DQEBCwUAA4IBAQA+AWDmmgxrZ6PZlPemORnkUH1RYLRPUtk9RjDXyTdwPDoL
          aXRXomfEImCUbp5TcRAKAY2wUH/MciM9+KRoAj/8v920HGNlR1KBXtejK8t39gRL
          zHLFDB4bJs59gSJYgP4Qd3vYokdBfOD3zaamhXiZWD8gCMa/VhDH5KP39p64Lcb0
          cImvXpQU736WnOp9b6raeV5u16kk3vS0RMEWrF/lIONNPMhRbYwltvMJ0BOvK5Ck
          vJ6iEqEAQaDVm/zp7LjWifCwEkKLo8+2h+IFGJJKbsXFk4QH2261+oeYIW94LubA
          NvGjfu3VHwz/c8vKfy5pdgUPH2PKBpevvVq6y32M
          -----END CERTIFICATE-----


    - path: /etc/kubernetes/ssl/kube-controller-manager-key.pem
      filesystem: root
      mode: 0600
      contents:
        inline: |
          -----BEGIN RSA PRIVATE KEY-----
          MIIEowIBAAKCAQEAxSw6Gri/MHdAIpxXC7XvNEP9YYGJNnJm4j4zLOfKoeUs/BPD
          kyKwwBh1Iy30Fed1iphd3cOoOhQNRffY46eDGggAx4SSZAPDyfqGx/Fkcjjzj/9S
          za9dcMo97lG5N7IePHxILPEpJWuzs43zfBkXS2zvP4/25ebEuxD1/QhphNzW3WFc
          /et7y5OwNH4PHQnTHaS3jZZiZYJ4OXGwQ4NoJR8K0S3i82SXLeOL8lGgLCPtVji+
          Q67ZB0wP2z0E6/0K3f/ocoSgAWgaQog2GzgdObJFDzGk7A5pGZbTYLYinTyrFrHP
          nBLVc9e+Q487aqs8cCubIY5BTSUx3JkF1fzPWQIDAQABAoIBAA/so4C2/RH//5kM
          AWe7uOcCurseSCOyl6acGWv+CHqM1NZDDl+axKWvE/7UXktKl06rQaGAhNyz8+J7
          wvOX+tmmXdG/Xkdfmnd8mVgaod8rxFgT6e8cw7IxU1ElHo1mAFUoQHgIvib8jNXq
          mAikyiHYWXZLvUgSHD9zfjqCbGtDejPI+DiJrz7xMkU/R9VCEcKnj+0+U1b5ULWn
          2iIlbh8z6xNEMfnmNpCs/3pmE/TIeV+rXD/s1vBHwSh+oxA/Xvt7vVDWMjgeNj3k
          YXtm265hZwrhv2/fcRdJJYwmqhATOiBkYcx9gCKJ9cwN4Hcd7DhhhBSUvTrVzlTm
          zTrqDBUCgYEA/bqdkVWzXOyr8FhQMMcBVM4pT0oVYZBKqQC8cSjLvRrpHH6QPd6p
          QY5h6VRgpErwtTnRJBRkGFaKFqU3VBgvERGKgRBVYRQyaFJkUlHZSslGlRdlGhsr
          3XqWwjyjFXe8k/f21H2Ln+yAEmi5geyKdAp6qZcbYJpw28l94vYkLKMCgYEAxvAF
          VLN+NoolpbiaiuEKhhxYBhcwTQr4FCTmM+6Uo2p048UiAp2lZv3jnegCw+1eEEyK
          n328qSFqmowTKGSjmKON+73o3vQnUCMvMHT0p7h7Sf/KG8lYguFMWQvhnHeDwaC2
          haUdmK01ULunm1xyXAsRBiPTR6QYo4W59olnN9MCgYEA9S0+1RFbIJASFU1BL+Ed
          CDWu9U9BGeW0P1rWvQIO3c0DNOWXvDFMnGxZcH54ZEmGD5iu345Uqq/0/6zmqfw0
          funUTKLb3dMGYog7KNCuh/W2nprctz1KRdoPk+HENRpevxz9BpfKM970YtWPbFyF
          7Vuy6+14JwEVzUwGuSngCsECgYBL1f3CPzZy5hDZ7tiC7qzLWQy5LafNBsxxKWvU
          CjQBY7ixh1mis6P08f4OGP7M37TG89a4W/9KXiG8Tn+TG2I98sNSXx/htiMyamc3
          yq3lLe9Z0zehhgzGv8oR+/SCaBEDBBfwNHRm2kiDwTVwhTpXGiTgOVH2cniuBXFR
          qSl+3wKBgDagE8ptahAO+xdG1QpqFJtDiPYP58YiD4PGsYZPv5MsScYXk/1RXmuX
          4HXu5P1uR3KgBbHzkZBm/4uFCaYpmyCcyNkG2Z7OzJtzlCn3oH9zEycpho3Oig31
          t0kc/Zk8L6zDKwawUM2YzTQVcWV6BVCmer0sFY1mczhdDHANBmhn
          -----END RSA PRIVATE KEY-----
              

    - path: /etc/kubernetes/cni/net.d/10-flannel.conf
      filesystem: root
      mode: 0644
      contents:
        inline: |
          {
              "name": "podnet",
              "type": "flannel",
              "delegate": {
                  "forceAddress": true,
                  "isDefaultGateway": true,
                  "hairpinMode": true
              }
          }
    - path: /etc/flannel/options.en
      filesystem: root
      mode:       0644
      contents:
        inline: |
          ADVERTISE_IP=10.100.130.115
          COREOS_HOSTNAME=api-server-1

          ETCDCTL_CACERT=/var/lib/etcd/ssl/ca.pem
          ETCDCTL_CERT=/var/lib/etcd/ssl/etcd-nodes.pem
          ETCDCTL_KEY=/var/lib/etcd/ssl/etcd-nodes-key.pem
          ETCDCTL_ENDPOINTS="https://10.100.130.113:2379,https://10.100.130.111:2379,https://10.100.130.112:2379,https://10.100.130.114:2379"
          ETCDCTL_API=3 
          ETCD_ENDPOINTS="https://10.100.130.113:2379,https://10.100.130.111:2379,https://10.100.130.112:2379,https://10.100.130.114:2379"

          FLANNELD_IFACE=10.100.130.115
          FLANNELD_ETCD_ENDPOINTS="https://10.100.130.113:2379,https://10.100.130.111:2379,https://10.100.130.112:2379,https://10.100.130.114:2379"
          FLANNELD_ETCD_PREFIX="/coreos.com/network"

          LOCKSMITHCTL_ETCD_CAFILE=/var/lib/etcd/ssl/ca.pem
          LOCKSMITHCTL_ETCD_CERTFILE=/var/lib/etcd/ssl/etcd-nodes.pem
          LOCKSMITHCTL_ETCD_KEYFILE=/var/lib/etcd/ssl/etcd-nodes-key.pem
          LOCKSMITHCTL_ENDPOINT="https://10.100.130.113:2379,https://10.100.130.111:2379,https://10.100.130.112:2379,https://10.100.130.114:2379"
    - path: /etc/systemd/system/flanneld.service.d/40-ExecStartPre-symlink.conf
      filesystem: root
      mode: 0644
      contents:
        inline: |
          [Service]
          ExecStartPre=/usr/bin/ln -sf /etc/flannel/options.env /run/flannel/options.env
          ExecStartPre=/usr/bin/ln -sf /etc/kubernetes/ssl /etc/kubernetes/pki
    
    - path: /etc/kubernetes/cni/docker_opts_cni.env
      filesystem: root
      mode: 0644
      contents:
        inline: |
          DOCKER_OPT_BIP=""
          DOCKER_OPT_IPMASQ=""
    - path: /etc/systemd/system/docker.service.d/40-flannel.conf
      filesystem: root
      mode: 0644
      contents:
        inline: |
          [Unit]
          Requires=flanneld.service
          After=flanneld.service
          [Service]
          EnvironmentFile=/etc/kubernetes/cni/docker_opts_cni.env
    
    - path: /etc/kubernetes/kubelet.env
      filesystem: root
      mode: 0644
      contents:
        inline: |
          KUBELET_IMAGE_URL=gcr.io/google_containers/hyperkube
          KUBELET_VERSION=v1.13.1
    - path: /etc/kubernetes/ssl/kubeconfig.yaml 
      filesystem: root
      mode: 0644
      contents:
        inline: |
          apiVersion: v1  
          kind: Config
          clusters:
          - name: local
            cluster:
              server: https://10.100.130.115:443
              certificate-authority: /etc/kubernetes/ssl/ca.pem
          users:
          - name: kubelet
            user:
              client-certificate: /etc/kubernetes/ssl/apiserver.pem
              client-key: /etc/kubernetes/ssl/apiserver-key.pem
          contexts:
          - context:
              cluster: local
              user: kubelet
      

      # not used 
    - path: /etc/kubernetes/ssl/bootstrap-kubeconfig.yaml
      filesystem: root
      mode: 0644
      contents:
        inline: |
          apiVersion: v1
          kind: Config
          clusters:
          - name: local
            cluster:
              certificate-authority: /etc/kubernetes/ssl/ca.pem
              server: https://10.100.130.115:443
          contexts:
          - context:
              cluster: local
              user: tls-bootstrap-token-user
            name: tls-bootstrap-token-user@kubernets
          current-context: tls-bootstrap-token-user@kubernets
          preferences: {}
          users:
          - name: tls-bootstrap-token-user
            user:
              token: ba7lwu.7volidj03khoqr8m
    - path: /etc/kubernetes/ssl/token-bootstrap-auth.csv
      filesystem: root
      mode: 0644
      contents:
        inline: |
          ba7lwu.7volidj03khoqr8m,kubelet-bootstrap,10001,'system:node-bootstrapper'


    - path: /etc/kubernetes/config.yaml
      filesystem: root
      mode: 0644
      contents:
        inline: |
          address: 0.0.0.0
          apiVersion: kubelet.config.k8s.io/v1beta1
          authentication:
            anonymous:
              enabled: false
            webhook:
              cacheTTL: 2m0s
              enabled: true
            x509:
              clientCAFile: /etc/kubernetes/ssl/ca.pem
          authorization:
            mode: Webhook
            webhook:
              cacheAuthorizedTTL: 5m0s
              cacheUnauthorizedTTL: 30s
          cgroupDriver: cgroupfs
          cgroupsPerQOS: true
          clusterDNS:
          - 10.3.0.10
          clusterDomain: mkoyan.local
          containerLogMaxFiles: 5
          containerLogMaxSize: 10Mi
          contentType: application/vnd.kubernetes.protobuf
          cpuCFSQuota: true
          cpuManagerPolicy: none
          cpuManagerReconcilePeriod: 10s
          enableControllerAttachDetach: true
          enableDebuggingHandlers: true
          enforceNodeAllocatable:
          - pods
          eventBurst: 10
          eventRecordQPS: 5
          evictionHard:
            imagefs.available: 15%
            memory.available: 100Mi
            nodefs.available: 10%
            nodefs.inodesFree: 5%
          evictionPressureTransitionPeriod: 5m0s
          failSwapOn: true
          fileCheckFrequency: 20s
          hairpinMode: promiscuous-bridge
          healthzBindAddress: 127.0.0.1
          healthzPort: 10248
          httpCheckFrequency: 20s
          imageGCHighThresholdPercent: 85
          imageGCLowThresholdPercent: 80
          imageMinimumGCAge: 2m0s
          iptablesDropBit: 15
          iptablesMasqueradeBit: 14
          kind: KubeletConfiguration
          tlsCertFile: "/etc/kubernetes/ssl/apiserver.pem"
          tlsPrivateKeyFile: "/etc/kubernetes/ssl/apiserver-key.pem"
          RotateCertificates: true
          ServerTLSBootstrap: true
          kubeAPIBurst: 10
          kubeAPIQPS: 5
          makeIPTablesUtilChains: true
          maxOpenFiles: 1000000
          maxPods: 110
          nodeStatusUpdateFrequency: 10s
          oomScoreAdj: -999
          podPidsLimit: -1
          port: 10250
          registryBurst: 10
          registryPullQPS: 5
          resolvConf: /etc/resolv.conf
          rotateCertificates: true
          runtimeRequestTimeout: 2m0s
          serializeImagePulls: true
          staticPodPath: /etc/kubernetes/manifests
          streamingConnectionIdleTimeout: 4h0m0s
          syncFrequency: 1m0s
          volumeStatsAggPeriod: 1m0s




    - path: /etc/kubernetes/manifests/kube-apiserver.yaml
      filesystem: root
      mode: 0644
      contents:
        inline: |
          apiVersion: v1
          kind: Pod
          metadata:
            name: kube-apiserver
            namespace: kube-system
          spec:
            hostNetwork: true
            containers:
            - name: kube-apiserver
              image: gcr.io/google_containers/hyperkube:v1.13.1
              command:
              - /hyperkube
              - apiserver
              - --bind-address=0.0.0.0
              - --etcd-servers=https://10.100.130.113:2379,https://10.100.130.111:2379,https://10.100.130.112:2379,https://10.100.130.114:2379
              - --allow-privileged=true
              - --service-cluster-ip-range=10.3.0.0/21
              - --secure-port=443
              - --advertise-address=10.100.130.115
              - --storage-backend=etcd3
              - --storage-media-type=application/json
              - --admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota,DefaultStorageClass,PersistentVolumeLabel
              #- --admission-control=Initializers,NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuotaInitializers,NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota
              # etcd ca 
              - --etcd-certfile=/var/lib/etcd/ssl/etcd-nodes.pem
              - --etcd-keyfile=/var/lib/etcd/ssl/etcd-nodes-key.pem
              - --etcd-cafile=/var/lib/etcd/ssl/ca.pem
              # api crt
              - --tls-cert-file=/etc/kubernetes/ssl/apiserver.pem
              - --tls-private-key-file=/etc/kubernetes/ssl/apiserver-key.pem
              - --client-ca-file=/etc/kubernetes/ssl/ca.pem
              # 
              - --kubelet-certificate-authority=/etc/kubernetes/ssl/ca.pem
              - --kubelet-client-certificate=/etc/kubernetes/ssl/apiserver.pem
              - --kubelet-client-key=/etc/kubernetes/ssl/apiserver-key.pem
              # service account When a process is authenticated through a service account, 
              # it can contact the API server and access cluster resources, check why just cert file
              - --service-account-key-file=/etc/kubernetes/ssl/service-account.pem
              - --runtime-config=extensions/v1beta1/networkpolicies=true,extensions/v1beta1=true,rbac.authorization.k8s.io/v1
              - --authorization-mode=Node,RBAC
              - --token-auth-file=/etc/kubernetes/ssl/token-bootstrap-auth.csv
              - --anonymous-auth=false
              - --audit-log-path=/var/log/kubernetes/kube-apiserver-audit.log
              - --audit-log-maxage=30
              - --audit-log-maxbackup=3
              - --audit-log-maxsize=100
              - --v=3
              livenessProbe:
                httpGet:
                  host: 127.0.0.1
                  port: 8080
                  path: /healthz
                initialDelaySeconds: 15
                timeoutSeconds: 15
              ports:
              - containerPort: 443
                hostPort: 443
                name: https
              - containerPort: 8080
                hostPort: 8080
                name: local
              volumeMounts:
              - mountPath: /etc/kubernetes/ssl
                name: ssl-certs-kubernetes
                readOnly: true
              - mountPath: /var/lib/etcd/ssl
                name: ssl-certs-etcd
                readOnly: true
              - mountPath: /etc/ssl/certs
                name: ssl-certs-host
                readOnly: true
              - mountPath: /var/log/kubernetes
                name: var-log-kubernetes
                readOnly: false
            volumes:
            - hostPath:
                path: /etc/kubernetes/ssl
              name: ssl-certs-kubernetes
            - hostPath:
                path: /var/lib/etcd/ssl
              name: ssl-certs-etcd
            - hostPath:
                path: /usr/share/ca-certificates
              name: ssl-certs-host
            - hostPath:
                path: /var/log/kubernetes
              name: var-log-kubernetes

    - path: /etc/kubernetes/manifests/kube-controller-manager.yaml
      filesystem: root
      mode: 0644
      contents:
        inline: |
          apiVersion: v1
          kind: Pod
          metadata:
            name: kube-controller-manager
            namespace: kube-system
          spec:
                hostNetwork: true
                containers:
                - name: kube-controller-manager
                  image: gcr.io/google_containers/hyperkube:v1.13.1
                  command:
                  - ./hyperkube
                  - controller-manager
                  - --master=https://10.100.130.115:443
                  # use kubeconfig
                  - --kubeconfig=/etc/kubernetes/ssl/kubeconfig.yaml
                  - --authentication-kubeconfig=/etc/kubernetes/ssl/kubeconfig.yaml
                  - --authorization-kubeconfig=/etc/kubernetes/ssl/kubeconfig.yaml
                  - --client-ca-file=/etc/kubernetes/ssl/ca.pem
                  - --leader-elect=true
                  - --allocate-node-cidrs=true
                  - --cluster-cidr=10.244.0.0/16
                  - --service-cluster-ip-range=10.3.0.0/21
                  # used for accessing to api
                  - --root-ca-file=/etc/kubernetes/ssl/ca.pem
                  - --tls-cert-file=/etc/kubernetes/ssl/kube-controller-manager.pem
                  - --tls-private-key-file=/etc/kubernetes/ssl/kube-controller-manager-key.pem
                  # sign request for mkoyan.local
                  - --cluster-signing-cert-file=/etc/kubernetes/ssl/ca.pem
                  - --cluster-signing-key-file=/etc/kubernetes/ssl/ca-key.pem
                  # service account
                  - --service-account-private-key-file=/etc/kubernetes/ssl/service-account.pem
                  - --use-service-account-credentials=true
                  - --experimental-cluster-signing-duration=87600h0m0s
                  livenessProbe:
                    httpGet:
                      host: 127.0.0.1
                      path: /healthz
                      port: 10252  # Note: Using default port. Update if --port option is set differently.
                    initialDelaySeconds: 15
                    timeoutSeconds: 5
                  volumeMounts:
                  - mountPath: /etc/ssl/certs
                    name: ssl-host
                    readOnly: true
                  - mountPath: /var/log/kube-controller-manager.log
                    name: logfile
                    readOnly: false
                  - mountPath: /etc/kubernetes/ssl
                    name: kube-ssl
                    readOnly: true
                volumes:
                - hostPath:
                    path: /usr/share/ca-certificates
                  name: ssl-host
                - hostPath:
                    path: /var/log/kube-controller-manager.log
                  name: logfile
                - hostPath:
                    path: /etc/kubernetes/ssl
                  name: kube-ssl


    - path: /etc/kubernetes/manifests/kube-proxy.yaml
      filesystem: root
      mode: 0644
      contents:
        inline: |
          apiVersion: v1
          kind: Pod
          metadata:
            name: kube-proxy
            namespace: kube-system
            labels:
              tier: node
              k8s-app: kube-proxy
          spec:
                hostNetwork: true
                containers:
                - name: kube-proxy
                  image: gcr.io/google_containers/hyperkube:v1.13.1
                  command:
                  - ./hyperkube
                  - proxy
                  - --master=https://10.100.130.115:443
                  - --kubeconfig=/etc/kubernetes/ssl/kubeconfig.yaml
                  - --logtostderr=true
                  - --proxy-mode=iptables
                  - --masquerade-all
                  - --hostname-override=10.100.130.115
                  - --cluster-cidr=10.244.0.0/16
                  - --v=3
                  env:
                    - name: NODE_NAME
                      valueFrom:
                        fieldRef:
                          fieldPath: spec.nodeName
                  securityContext:
                    privileged: true
                  volumeMounts:
                  - mountPath: /etc/ssl/certs
                    name: ssl-certs-host
                    readOnly: true
                  - name: kube-ssl
                    mountPath: /etc/kubernetes/ssl
                    readOnly: true
                tolerations:
                - key: "node-role.kubernetes.io/master"
                  operator: "Exists"
                  effect: "NoSchedule"
                volumes:
                - hostPath:
                    path: /usr/share/ca-certificates
                  name: ssl-certs-host
                - name: kube-ssl
                  hostPath:
                    path: /etc/kubernetes/ssl

    - path: /etc/kubernetes/manifests/kube-scheduler.yaml
      filesystem: root
      mode: 0644
      contents:
        inline: |
          apiVersion: v1
          kind: Pod
          metadata:
            name: kube-scheduler
            namespace: kube-system
          spec:
            hostNetwork: true
            containers:
            - name: kube-scheduler
              image: gcr.io/google_containers/hyperkube:v1.13.1
              command:
              - ./hyperkube
              - scheduler
              - --master=https://10.100.130.115:443
              - --kubeconfig=/etc/kubernetes/ssl/kubeconfig.yaml
              - --address=0.0.0.0
              - --leader-elect=true
              - --v=3
              livenessProbe:
                  httpGet:
                    host: 127.0.0.1
                    path: /healthz
                    port: 10251  # Note: Using default port. Update if --port option is set differently.
                  initialDelaySeconds: 15
                  timeoutSeconds: 15
              nodeSelector:
                node-role.kubernetes.io/master: ""
              securityContext:
                runAsNonRoot: true
                runAsUser: 65534
              volumeMounts:
              - mountPath: /var/log/kube-scheduler.log
                name: logfile
              - mountPath: /etc/kubernetes/ssl
                name: "kube-ssl"
                readOnly: true
            volumes:
            - hostPath:
                path: /var/log/kube-scheduler.log
              name: logfile
            - hostPath:
                path: "/etc/kubernetes/ssl"
              name: "kube-ssl"



systemd:
  units:
    - name: kubelet.service
      enabled: true
      contents: |
        [Unit]
        Description=The primary agent to run pods
        Documentation=http://kubernetes.io/docs/admin/kubelet/
        Requires=etcd-member.service
        After=flanneld.service
        
        [Service]
        Slice=system.slice
        Environment=RKT_GLOBAL_ARGS="--insecure-options=image"
        Environment=KUBELET_IMAGE_URL=docker://gcr.io/google_containers/hyperkube
        Environment=KUBELET_IMAGE_TAG=v1.13.1
        Environment=#HTTP_PROXY=
        Environment=#HTTPS_PROXY=
        #Environment=##http_proxy=
        #Environment=##https_proxy=
        Environment=no_proxy=localhost,127.0.0.0/8,127.0.0.1,::1,172.20.0.11,172.20.0.12,172.20.0.13,coreos-1,coreos-2,coreos-3,coreos-1.mkoyan.local,coreos-2.mkoyan.local,coreos-3.mkoyan.local,/var/run/docker.sock
        ExecStart=/usr/lib/coreos/kubelet-wrapper \
          --register-node=true \
          --hostname-override=kube-apiserver \
          --kubeconfig=/etc/kubernetes/ssl/kubeconfig.yaml \
          --config=/etc/kubernetes/config.yaml \
          --network-plugin=cni \
          --cni-conf-dir=/etc/kubernetes/cni/net.d \
          --lock-file=/var/run/lock/kubelet.lock \
          --exit-on-lock-contention \
          --logtostderr=true \
          --v=2
        Restart=always
        StartLimitInterval=0
        RestartSec=10
        
        [Install]
        WantedBy=multi-user.target

    - name: settimezone.service
      enabled: true
      contents: |
        [Unit]
        Description=Set the time zone
        [Service]
        ExecStart=/usr/bin/timedatectl set-timezone Asia/Yerevan
        RemainAfterExit=yes
        Type=oneshot


    - name: flanneld.service
      dropins:
        - name: 50-network-config.conf
          contents: |
            [Service]
            EnvironmentFile=/etc/flannel/options.env
            ExecStartPre=/usr/bin/etcdctl set /coreos.com/network/config '{"Network":"10.244.0.0/16", "Backend": {"Type": "vxlan","VNI": 1}}'
            Restart=always

    - name: flanneld.service
      dropins:
        - name: 50-ssl.conf
          contents: |
            [Service]
            Environment="ETCD_SSL_DIR=/var/lib/etcd/ssl"



    - name: docker.service
      enabled: false
      dropins:
        - name: 50-insecure-registry.conf
          contents: |
            [Service]
            Environment=DOCKER_OPTS=''
            #Environment=#HTTP_PROXY=
            #Environment=#HTTPS_PROXY=
            #Environment=##http_proxy=
            #Environment=##https_proxy=
            #Environment=no_proxy=localhost,127.0.0.0/8,127.0.0.1,::1,10.100.130.115,172.20.0.12,172.20.0.13,coreos-1,coreos-2,coreos-3,coreos-1.mkoyan.local,coreos-2.mkoyan.local,coreos-3.mkoyan.local,/var/run/docker.sock

flannel:
  version:        0.11.0
  etcd_prefix:    /coreos.com/network
  etcd_endpoints: https://10.100.130.113:2379,https://10.100.130.111:2379,https://10.100.130.112:2379,https://10.100.130.114:2379
  etcd_cafile:    /var/lib/etcd/ssl/ca.pem
  etcd_certfile:  /var/lib/etcd/ssl/etcd-nodes.pem
  etcd_keyfile:   /var/lib/etcd/ssl/etcd-nodes-key.pem
  interface:      ens192